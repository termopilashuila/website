(()=>{var e={7518:e=>{class t{constructor(e={}){this.config={popupDelay:e.popupDelay||4e3,timerDuration:e.timerDuration||100,backendUrl:e.backendUrl||"https://script.google.com/macros/s/AKfycbwXCkqjA3d4Lj26TWXCHHgg16Z6UYdahdh4fP5kWVqUs0wCokys_TASoiy2Sr5GwktN3g/exec",popupId:e.popupId||"discount-popup",...e},this.timer=this.config.timerDuration,this.timerInterval=null,this.popupShown=!1,this.elements={},this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this.initializeDOM())):this.initializeDOM()}initializeDOM(){this.getDOMElements(),this.elements.popup?(this.setupEventListeners(),this.schedulePopup()):console.warn("[Discount Popup] Popup element not found")}getDOMElements(){this.elements={popup:document.getElementById(this.config.popupId),closeBtn:document.getElementById("discount-popup-close"),form:document.getElementById("discount-popup-form"),emailInput:document.getElementById("discount-popup-email"),errorDiv:document.getElementById("discount-popup-error"),successDiv:document.getElementById("discount-popup-success"),timerSpan:document.getElementById("discount-timer")}}setupEventListeners(){this.elements.closeBtn&&this.elements.closeBtn.addEventListener("click",(()=>{console.log("[Discount Popup] Close button clicked"),this.trackEvent("discount_popup_closed","engagement","close_button"),this.hidePopup()})),this.elements.popup.addEventListener("click",(e=>{e.target===this.elements.popup&&(console.log("[Discount Popup] Backdrop clicked, closing popup"),this.trackEvent("discount_popup_closed","engagement","backdrop_click"),this.hidePopup())}));const e=this.elements.popup.querySelector('div[style*="background:#fff"]');e&&e.addEventListener("click",(e=>{e.stopPropagation()})),this.elements.form&&this.elements.form.addEventListener("submit",(e=>this.handleFormSubmission(e)))}schedulePopup(){console.log(`[Discount Popup] Scheduling popup with ${this.config.popupDelay/1e3} second delay`),setTimeout((()=>this.showPopup()),this.config.popupDelay)}showPopup(){this.popupShown?console.log("[Discount Popup] Popup already shown, skipping"):(console.log("[Discount Popup] Showing popup"),this.elements.popup.style.display="flex",this.popupShown=!0,this.timer=this.config.timerDuration,this.elements.timerSpan&&(this.elements.timerSpan.textContent=this.timer),this.trackEvent("discount_popup_shown","engagement","popup_displayed"),this.startTimer())}hidePopup(){console.log("[Discount Popup] Hiding popup"),this.elements.popup.style.display="none",this.clearTimer()}startTimer(){this.clearTimer(),this.timerInterval=setInterval((()=>{this.timer--,this.elements.timerSpan&&(this.elements.timerSpan.textContent=this.timer),this.timer<=0&&(console.log("[Discount Popup] Timer expired, hiding popup"),this.trackEvent("discount_popup_timeout","engagement","timer_expired"),this.hidePopup())}),1e3)}clearTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}handleFormSubmission(e){e.preventDefault(),console.log("[Discount Popup] Form submission started");const t=this.elements.emailInput.value.trim();if(console.log("[Discount Popup] Email input value:",t),!this.validateEmail(t))return console.warn("[Discount Popup] Email validation failed:",t),void this.showError("Por favor ingresa un correo vÃ¡lido.");console.log("[Discount Popup] Email validation passed"),this.hideError(),this.submitEmail(t)}async submitEmail(e){console.log("[Discount Popup] Sending request to backend...");try{const t=new URLSearchParams;t.append("email",e);const s=Date.now();console.log("[Discount Popup] Request started at:",(new Date).toISOString());const o=await fetch(this.config.backendUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()}),n=Date.now()-s;if(console.log(`[Discount Popup] Response received in ${n}ms`),console.log("[Discount Popup] Response status:",o.status,o.statusText),!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const i=await o.text();console.log("[Discount Popup] Raw response text:",i);const r=this.parseResponse(i);this.handleResponse(r,e)}catch(e){console.error("[Discount Popup] Request failed:",e),this.showError("Hubo un error. Intenta de nuevo."),this.trackEvent("discount_popup_network_error","error",e.message||"network_error")}}parseResponse(e){try{const t=JSON.parse(e);return console.log("[Discount Popup] Successfully parsed JSON response:",t),t}catch(t){return console.warn("[Discount Popup] Response is not JSON, attempting to parse as text:",t.message),e.toLowerCase().includes("success")||e.toLowerCase().includes("ok")||"Success"===e?(console.log("[Discount Popup] Detected success response in text format"),{result:"success"}):(console.error("[Discount Popup] Unknown response format:",e),{result:"error",error:"Invalid response format: "+e})}}handleResponse(e,t){console.log("[Discount Popup] Backend response:",e),"success"===e.result?(console.log("[Discount Popup] Email submission successful for:",t),this.showSuccess(),this.trackEvent("discount_popup_success","engagement","email_collected",{custom_parameter_email_domain:t.split("@")[1]||"unknown"})):(console.error("[Discount Popup] Backend returned error:",e.error||"Unknown error"),this.showError("Hubo un error. Intenta de nuevo."),this.trackEvent("discount_popup_backend_error","error",e.error||"backend_error"))}showSuccess(){this.elements.form&&(this.elements.form.style.display="none"),this.elements.successDiv&&(this.elements.successDiv.style.display="block"),setTimeout((()=>this.hidePopup()),2e3)}showError(e){this.elements.errorDiv&&(this.elements.errorDiv.textContent=e,this.elements.errorDiv.style.display="block")}hideError(){this.elements.errorDiv&&(this.elements.errorDiv.style.display="none")}validateEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);return console.log(`[Discount Popup] Email validation result for "${e}":`,t),t}trackEvent(e,t,s,o={}){window.gtag&&"function"==typeof window.gtag&&(console.log(`[Discount Popup] Tracking event: ${e}`),window.gtag("event",e,{event_category:t,event_label:s,...o}))}show(){this.showPopup()}hide(){this.hidePopup()}isVisible(){return this.elements.popup&&"flex"===this.elements.popup.style.display}reset(){this.popupShown=!1,this.timer=this.config.timerDuration,this.clearTimer(),this.elements.form&&(this.elements.form.style.display="block",this.elements.form.reset()),this.elements.successDiv&&(this.elements.successDiv.style.display="none"),this.hideError()}}window.discountPopupHandler=new t,e.exports&&(e.exports=t)}},t={},s=function s(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,s),i.exports}(7518);module.exports=s})();