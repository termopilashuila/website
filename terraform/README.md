# Terraform Infrastructure

This project has been converted from Terragrunt to standard Terraform. It manages Google Cloud Platform infrastructure including service accounts, BigQuery, Cloud Run, and other services.

## Project Structure

```plaintext
terraform/
├── main.tf              # Main module calls
├── backend.tf           # Remote state configuration
├── provider.tf          # Provider configuration
├── locals.tf            # Local values and configuration loading
├── versions.tf          # Terraform and provider version constraints
├── outputs.tf           # Root-level outputs
├── config.json          # Configuration file (JSON format)
└── modules/             # Infrastructure modules
    ├── variables.tf     # Module input variables
    ├── locals.tf        # Module local values
    ├── provider.tf      # Module provider configuration
    ├── outputs.tf       # Module outputs
    ├── apis.tf          # Google Cloud APIs
    ├── service_accounts.tf # Service account resources
    ├── bigquery.tf      # BigQuery resources
    ├── cloud_run.tf     # Cloud Run resources
    ├── cloud_scheduler.tf # Cloud Scheduler resources
    ├── artifact_repo.tf # Artifact Registry
    └── backend.tf       # (legacy file, can be removed)
```

## Configuration

The project uses `config.json` to define all infrastructure settings. Update this file to customize your deployment:

- `project`: GCP project ID
- `location`: GCP region
- `remote_state_bucket_name`: GCS bucket for Terraform state
- `services`: Cloud Run services configuration
- `api_services`: GCP APIs to enable
- `service_account`: Service account and IAM configuration

## Usage

### Prerequisites

1. Install Terraform >= 1.0
2. Authenticate with Google Cloud (`gcloud auth application-default login`)
3. Ensure the state bucket exists in GCS

### Deployment

```bash
# Initialize Terraform
terraform init

# Plan the deployment
terraform plan

# Apply the changes
terraform apply

# View outputs
terraform output
```

### Migration from Terragrunt

This project was converted from Terragrunt. The key changes:

1. **Configuration**: Now passed as variables to modules instead of reading files directly
2. **Remote State**: Configured in `backend.tf` instead of generated by Terragrunt
3. **Module Structure**: The `modules/` directory is now called as a Terraform module
4. **Variables**: Added `variables.tf` in modules to accept configuration

### Backend Configuration

The backend is configured to use Google Cloud Storage. Make sure to:

1. Create the bucket specified in `config.json` (`remote_state_bucket_name`)
2. Update `backend.tf` if you need different state configuration

### Outputs

The following outputs are available:

- `service_account_email`: Email address of the created service account
- `service_account_name`: Full name of the service account
- `service_account_private_key`: Private key (sensitive)
- `service_account_decoded_private_key`: Decoded private key (sensitive)

## Customization

To modify the infrastructure:

1. Update `config.json` for configuration changes
2. Modify files in `modules/` for resource changes
3. Add new module calls in `main.tf` if needed
4. Update `outputs.tf` to expose new module outputs
